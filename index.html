<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ward Manager (UK)</title>
<style>
:root{
  color-scheme: light dark;
  --bg: Canvas;
  --fg: CanvasText;
  --muted: color-mix(in oklab, var(--fg) 65%, transparent);
  --line: color-mix(in oklab, var(--fg) 18%, transparent);
  --card: color-mix(in oklab, var(--bg) 92%, var(--fg) 8%);
  --accent: color-mix(in oklab, var(--fg) 80%, transparent);
  --radius: 14px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:var(--bg);
  color:var(--fg);
}
header{
  border-bottom:1px solid var(--line);
  padding:12px 16px;
  display:flex;
  align-items:center;
  gap:14px;
}
header h1{font-size:16px;margin:0;font-weight:900}
nav{display:flex;gap:8px}
nav button{
  border:1px solid var(--line);
  background:transparent;
  border-radius:999px;
  padding:6px 12px;
  font-weight:700;
  cursor:pointer;
  color:var(--muted);
}
nav button.active{
  background:var(--card);
  color:var(--fg);
}
main{max-width:1200px;margin:0 auto;padding:16px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:14px;
  margin-bottom:14px;
}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.spacer{flex:1}
h2{margin:0 0 6px 0;font-size:18px}
.small{font-size:12px;color:var(--muted)}
button.action{
  border:1px solid var(--line);
  background:transparent;
  border-radius:10px;
  padding:10px 12px;
  font-weight:700;
  cursor:pointer;
}
button.action:hover{filter:brightness(1.05)}
table{width:100%;border-collapse:collapse}
th,td{padding:8px 6px;border-bottom:1px solid var(--line);font-size:13px;text-align:left}
th{color:var(--muted)}
.log{font-family:ui-monospace,monospace;font-size:12px;white-space:pre-wrap}
.hidden{display:none}
.badge{
  border:1px solid var(--line);
  border-radius:999px;
  padding:2px 8px;
  font-size:11px;
  color:var(--muted);
}
.warn{color:#b00020}
.good{color:#0a7}
</style>
</head>

<body>
<header>
  <h1>Ward Manager (UK)</h1>
  <nav>
    <button data-screen="hq" class="active">Campaign HQ</button>
    <button data-screen="field">Field View</button>
    <button data-screen="intel">Intel Room</button>
  </nav>
  <div class="spacer"></div>
  <span class="badge" id="weekLabel"></span>
</header>

<main>

<!-- CAMPAIGN HQ -->
<section id="screen-hq">
  <div class="card">
    <h2>Resources</h2>
    <div class="row">
      <span>Money: <b id="money"></b></span>
      <span>Volunteers: <b id="vols"></b></span>
      <span>Energy: <b id="energy"></b></span>
    </div>
  </div>

  <div class="card">
    <h2>Campaign Actions</h2>
    <div class="row">
      <button class="action" onclick="fundraise()">Fundraise</button>
      <button class="action" onclick="leaflet()">Leaflet Drop</button>
      <button class="action" onclick="canvass()">Door Knocking</button>
      <button class="action" onclick="rest()">Rest Candidate</button>
    </div>
    <div class="small">Actions affect specific voter segments and generate delayed effects.</div>
  </div>

  <div class="card">
    <h2>Volunteer Roster</h2>
    <table>
      <thead><tr><th>Name</th><th>Skill</th><th>Burnout</th><th>Status</th></tr></thead>
      <tbody id="volTable"></tbody>
    </table>
  </div>
</section>

<!-- FIELD VIEW -->
<section id="screen-field" class="hidden">
  <div class="card">
    <h2>Districts & Segments</h2>
    <table>
      <thead>
        <tr>
          <th>District</th>
          <th>Key Segment</th>
          <th>Your Support</th>
          <th>Turnout Risk</th>
        </tr>
      </thead>
      <tbody id="districtTable"></tbody>
    </table>
  </div>
</section>

<!-- INTEL ROOM -->
<section id="screen-intel" class="hidden">
  <div class="card">
    <h2>Polling Summary</h2>
    <div id="pollSummary"></div>
    <div class="small">Polling is noisy and lags reality.</div>
  </div>

  <div class="card">
    <h2>Recent Effects</h2>
    <div class="log" id="effectsLog"></div>
  </div>

  <div class="card">
    <h2>Rumours & Whispers</h2>
    <div class="log" id="rumourLog"></div>
  </div>
</section>

</main>

<script>
/* CORE STATE */
const GAME={
  week:1,
  money:5000,
  energy:80,
  volunteers:[
    {name:"Anna",skill:0.7,burnout:0},
    {name:"Dave",skill:0.5,burnout:0},
    {name:"Leila",skill:0.8,burnout:0}
  ],
  districts:[
    {name:"Riverside Estate",segment:"Young renters",support:0.22,turnout:0.32},
    {name:"Old Greybridge",segment:"Older owners",support:0.26,turnout:0.64},
    {name:"Kingsway Newbuilds",segment:"Young professionals",support:0.30,turnout:0.42},
    {name:"St. Mark’s Village",segment:"Older owners",support:0.18,turnout:0.66},
    {name:"Industrial Crescent",segment:"Working families",support:0.28,turnout:0.38},
  ],
  rumours:[],
  effects:[]
};

/* UI NAV */
document.querySelectorAll("nav button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll("nav button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    document.querySelectorAll("main section").forEach(s=>s.classList.add("hidden"));
    document.getElementById("screen-"+b.dataset.screen).classList.remove("hidden");
  };
});

/* ACTIONS */
function fundraise(){
  const gain=Math.floor(400+Math.random()*600);
  GAME.money+=gain;
  GAME.effects.push(`Fundraising brought in £${gain}.`);
  if(Math.random()<0.25){
    GAME.rumours.push("Rumour: campaign taking money from questionable local donors.");
  }
  endTurn();
}

function leaflet(){
  if(GAME.money<300){alert("Not enough money");return;}
  GAME.money-=300;
  const d=pick(GAME.districts);
  d.support+=0.01;
  GAME.effects.push(`Leaflets improved support in ${d.name} (${d.segment}).`);
  endTurn();
}

function canvass(){
  if(GAME.energy<10){alert("Candidate exhausted");return;}
  GAME.energy-=10;
  const d=pick(GAME.districts);
  const vol=pick(GAME.volunteers);
  d.support+=0.015*vol.skill;
  vol.burnout+=0.15;
  GAME.effects.push(`Canvassing helped with ${d.segment} in ${d.name}.`);
  if(vol.burnout>0.7){
    GAME.rumours.push(`${vol.name} is burning out and complaining to others.`);
  }
  endTurn();
}

function rest(){
  GAME.energy=Math.min(100,GAME.energy+20);
  GAME.effects.push("Candidate rested. Energy restored.");
  endTurn();
}

/* TURN */
function endTurn(){
  GAME.week++;
  render();
}

/* RENDER */
function render(){
  weekLabel.textContent=`Week ${GAME.week}`;
  money.textContent=`£${GAME.money}`;
  energy.textContent=GAME.energy;
  vols.textContent=GAME.volunteers.length;

  volTable.innerHTML="";
  GAME.volunteers.forEach(v=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${v.name}</td><td>${Math.round(v.skill*100)}</td><td>${Math.round(v.burnout*100)}%</td><td>${v.burnout>0.8?"At risk":"OK"}</td>`;
    volTable.appendChild(tr);
  });

  districtTable.innerHTML="";
  GAME.districts.forEach(d=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${d.name}</td><td>${d.segment}</td><td>${Math.round(d.support*100)}%</td><td>${Math.round(d.turnout*100)}%</td>`;
    districtTable.appendChild(tr);
  });

  pollSummary.innerHTML=`You polling at ${(avgSupport()*100).toFixed(1)}% (est).`;
  effectsLog.textContent=GAME.effects.slice(-6).join("\n")||"—";
  rumourLog.textContent=GAME.rumours.slice(-6).join("\n")||"—";
}

function avgSupport(){
  return GAME.districts.reduce((a,d)=>a+d.support,0)/GAME.districts.length;
}
function pick(a){return a[Math.floor(Math.random()*a.length)]}

render();
</script>
</body>
</html>
